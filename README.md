# ğŸŒ æ™ºèƒ½æ—…è¡Œè§„åˆ’åŠ©æ‰‹

<div align="center">

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![LangChain](https://img.shields.io/badge/LangChain-v1-green.svg)](https://python.langchain.com/)
[![LangGraph](https://img.shields.io/badge/LangGraph-Latest-orange.svg)](https://langchain-ai.github.io/langgraph/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

åŸºäº LangChain v1 å’Œ LangGraph æ„å»ºçš„æ™ºèƒ½æ—…è¡Œè§„åˆ’ç³»ç»Ÿ  
é›†æˆå¤šæº API å’Œ MCP åè®®ï¼Œå®ç°å…¨æµç¨‹æ—…è¡Œè§„åˆ’å’Œä¸ªæ€§åŒ–æ¨è

[åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [æ¶æ„è®¾è®¡](#-æ¶æ„è®¾è®¡) â€¢ [ä½¿ç”¨ç¤ºä¾‹](#-ä½¿ç”¨ç¤ºä¾‹) â€¢ [å¼€å‘æ–‡æ¡£](#-å¼€å‘æ–‡æ¡£)

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸš„ äº¤é€šæŸ¥è¯¢
- **ç«è½¦ç¥¨æŸ¥è¯¢**ï¼šé›†æˆ 12306 MCP æœåŠ¡ï¼Œæ”¯æŒé«˜é“ã€åŠ¨è½¦ç¥¨æŸ¥è¯¢
- **è½¦æ¬¡ä¿¡æ¯**ï¼šæŸ¥è¯¢è½¦æ¬¡ç»åœç«™ã€å‘è½¦æ—¶é—´ã€ç¥¨ä»·ä¿¡æ¯
- **è·¨è¯­è¨€è°ƒç”¨**ï¼šé€šè¿‡ STDIO åè®®ä¸ Node.js MCP æœåŠ¡é€šä¿¡

### ğŸ—ºï¸ åœ°ç†ä¿¡æ¯
- **å¤©æ°”æŸ¥è¯¢**ï¼šå®æ—¶è·å–ç›®çš„åœ°å¤©æ°”ä¿¡æ¯
- **åœ°ç‚¹æœç´¢**ï¼šæ”¯æŒåœ°ç†ç¼–ç ã€POI æœç´¢
- **å‘¨è¾¹æ¨è**ï¼šæŸ¥æ‰¾é™„è¿‘çš„ç¾é£Ÿã€æ™¯ç‚¹ã€é…’åº—ç­‰

### ğŸš— è·¯çº¿è§„åˆ’
- **å¤šç§å‡ºè¡Œæ–¹å¼**ï¼šæ”¯æŒå…¬äº¤/åœ°é“ã€æ­¥è¡Œã€é©¾è½¦ä¸‰ç§æ–¹å¼
- **æ™ºèƒ½è§„åˆ’**ï¼šæ ¹æ®ç”¨æˆ·åå¥½è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜è·¯çº¿
- **è¯¦ç»†å¯¼èˆª**ï¼šæä¾›åˆ†æ­¥å¯¼èˆªæŒ‡å¼•

### ğŸ¨ é…’åº—æ¨è
- **æ™ºèƒ½æœç´¢**ï¼šé›†æˆ AIGoHotel MCP æœåŠ¡ï¼ˆé€šè¿‡ ModelScopeï¼‰
- **æ˜Ÿçº§ç­›é€‰**ï¼šæ”¯æŒæŒ‰æ˜Ÿçº§ã€ä»·æ ¼ã€ä½ç½®ç­›é€‰
- **ä¸ªæ€§åŒ–æ¨è**ï¼šæ ¹æ®é¢„ç®—å’Œåå¥½è‡ªåŠ¨åŒ¹é…

### ğŸ” è¯„ä»·æœç´¢
- **çœŸå®å£ç¢‘**ï¼šé›†æˆ Tavily æœç´¢ APIï¼Œè·å–æ™¯ç‚¹ã€é¤å…çš„çœŸå®è¯„ä»·
- **ç½‘ç»œæœç´¢**ï¼šå®æ—¶è·å–æœ€æ–°çš„æ—…æ¸¸èµ„è®¯å’Œæ”»ç•¥

### ğŸ¯ ä¸ªæ€§åŒ–æ¨è
- **ç”¨æˆ·ç”»åƒ**ï¼šç»´æŠ¤ 8 ä¸ªç»´åº¦çš„æ—…è¡Œåå¥½
  - å…´è¶£åå¥½ï¼ˆå†å²æ–‡åŒ–ã€è‡ªç„¶é£å…‰ã€ç¾é£Ÿä½“éªŒç­‰ï¼‰
  - å‡ºè¡Œæ–¹å¼ï¼ˆæ­¥è¡Œã€å…¬äº¤ã€è‡ªé©¾ã€æ··åˆï¼‰
  - æ—…è¡ŒèŠ‚å¥ï¼ˆæ‚ é—²ã€é€‚ä¸­ã€ç´§å‡‘ï¼‰
  - é¢„ç®—æ°´å¹³ï¼ˆç»æµã€èˆ’é€‚ã€è±ªåï¼‰
  - ä½å®¿åå¥½ã€é¤é¥®åå¥½ã€ç‰¹æ®Šéœ€æ±‚ã€å¤©æ°”æ•æ„Ÿåº¦
- **æ™ºèƒ½å·¥ä½œæµ**ï¼šåŸºäº LangGraph æ„å»º 5 èŠ‚ç‚¹æ¨èæµç¨‹
  - åœ°ç‚¹æœç´¢ â†’ è¯„ä»·æŸ¥è¯¢ â†’ é…’åº—æ¨è â†’ è·¯çº¿è§„åˆ’ â†’ ç»“æœç”Ÿæˆ
- **åŠ¨æ€é€‚é…**ï¼šæ ¹æ®åå¥½è‡ªåŠ¨è°ƒæ•´æœç´¢å‚æ•°

### ğŸ’¬ å¯¹è¯ç®¡ç†
- **å¤šè½®å¯¹è¯**ï¼šåŸºäº LangGraph Checkpointer å®ç°ä¼šè¯çŠ¶æ€æŒä¹…åŒ–
- **ä¸Šä¸‹æ–‡æ‘˜è¦**ï¼šè‡ªåŠ¨å‹ç¼©é•¿å¯¹è¯ï¼ˆè§¦å‘é˜ˆå€¼ 4000 tokensï¼‰
- **åŠ¨æ€æç¤ºè¯**ï¼šæ ¹æ®å¯¹è¯å†…å®¹è‡ªåŠ¨åˆ‡æ¢ç³»ç»Ÿæç¤ºè¯

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10+
- Node.js 16+ (ç”¨äº 12306 MCP æœåŠ¡)
- pip æˆ– conda

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

```bash
git clone https://github.com/InfinteHeart/AI-Powered-Travel-Planning-Assistant.git
cd AI-Powered-Travel-Planning-Assistant
```

2. **å®‰è£… Python ä¾èµ–**

```bash
pip install langchain langgraph langchain-openai python-dotenv requests tavily-python
```

3. **é…ç½®ç¯å¢ƒå˜é‡**

åˆ›å»º `.env` æ–‡ä»¶å¹¶é…ç½®ä»¥ä¸‹ API Keysï¼š

```env
# DeepSeek API (æˆ–å…¶ä»–å…¼å®¹ OpenAI çš„ LLM)
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com

# é«˜å¾·åœ°å›¾ API
GAODE_API_KEY=your_gaode_api_key

# Tavily æœç´¢ API (å¯é€‰)
TAVILY_API_KEY=your_tavily_api_key

# AIGoHotel URL
AIGOHOTEL_MCP_URL=your_aigohotel-mcp_url
```

4. **å®‰è£… 12306 MCP æœåŠ¡**

```bash
cd mcp/12306-mcp-main
npm install
npm run build
cd ../..
```

5. **è¿è¡ŒåŠ©æ‰‹**

```bash
# æ–¹å¼ 1: ä½¿ç”¨å®Œæ•´ç‰ˆ Agent (æ¨è)
python -m agent.cli

# æ–¹å¼ 2: ä½¿ç”¨ç®€åŒ–ç‰ˆ Agent
python mcp-agent.py
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¾“å…¥ â†’ Agent (LangChain)
         â†“
    ä¸­é—´ä»¶å±‚ (Middleware)
    - SummarizationMiddleware (å¯¹è¯æ‘˜è¦)
    - DynamicPrompt (åŠ¨æ€æç¤ºè¯)
         â†“
    å·¥å…·å±‚ (Tools)
    - 12306 MCP Client (STDIO é€šä¿¡)
    - é«˜å¾· API Client (HTTP REST)
    - AIGoHotel MCP Client (ModelScope)
    - Tavily Search API
         â†“
    å·¥ä½œæµå±‚ (Workflow)
    - LangGraph StateGraph
    - 5èŠ‚ç‚¹æ¨èæµç¨‹
         â†“
    çŠ¶æ€ç®¡ç†å±‚ (State Management)
    - TravelContext (è¿è¡Œæ—¶ä¸Šä¸‹æ–‡)
    - UserPreferenceState (ç”¨æˆ·åå¥½çŠ¶æ€)
    - SessionManager (ä¼šè¯ç®¡ç†)
         â†“
    æŒä¹…åŒ–å±‚ (Persistence)
    - InMemorySaver (LangGraph Checkpointer)
```

### ç›®å½•ç»“æ„

```
project/
â”œâ”€â”€ agent/                      # Agent æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ agent.py                # ä¸» Agent ç±»
â”‚   â”œâ”€â”€ cli.py                  # å‘½ä»¤è¡Œäº¤äº’ç•Œé¢
â”‚   â”œâ”€â”€ middleware.py           # ä¸­é—´ä»¶å®ç°
â”‚   â”œâ”€â”€ session_manager.py      # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ preference_manager.py   # åå¥½ç®¡ç†
â”‚   â”œâ”€â”€ context_types.py        # TravelContext å®šä¹‰
â”‚   â””â”€â”€ user_preference_state.py # UserPreferenceState å®šä¹‰
â”œâ”€â”€ client/                     # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ mcp_12306_stdio_client.py  # 12306 MCP å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ gaode_client.py            # é«˜å¾·åœ°å›¾å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ aigohotel_client.py        # AIGoHotel MCP å®¢æˆ·ç«¯
â”‚   â””â”€â”€ route_planning_client.py   # è·¯çº¿è§„åˆ’å®¢æˆ·ç«¯
â”œâ”€â”€ tools/                      # LangChain å·¥å…·
â”‚   â”œâ”€â”€ traffic_tools.py        # äº¤é€šæŸ¥è¯¢å·¥å…·
â”‚   â”œâ”€â”€ gaode_tools.py          # é«˜å¾·åœ°å›¾å·¥å…·
â”‚   â”œâ”€â”€ hotel_tools.py          # é…’åº—æœç´¢å·¥å…·
â”‚   â”œâ”€â”€ web_search_tools.py     # ç½‘ç»œæœç´¢å·¥å…·
â”‚   â””â”€â”€ preference_tools.py     # åå¥½ç®¡ç†å·¥å…·
â”œâ”€â”€ workflow/                   # LangGraph å·¥ä½œæµ
â”‚   â””â”€â”€ recommendation_workflow.py  # æ¨èå·¥ä½œæµ
â”œâ”€â”€ prompts/                    # æç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ travel_system_prompts.py    # ç³»ç»Ÿæç¤ºè¯
â”œâ”€â”€ mcp/                        # MCP æœåŠ¡
â”‚   â””â”€â”€ 12306-mcp-main/         # 12306 MCP æœåŠ¡
â””â”€â”€ README.md                   # æœ¬æ–‡ä»¶
```

### æ ¸å¿ƒæŠ€æœ¯

- **LangChain v1**: Agent æ¡†æ¶ã€å·¥å…·è°ƒç”¨ã€ä¸­é—´ä»¶æœºåˆ¶ï¼ˆæ‘˜è¦ã€åŠ¨æ€æç¤ºè¯ï¼‰
- **LangGraph**: StateGraph çŠ¶æ€æœºç¼–æ’ã€Checkpointer ä¼šè¯ç®¡ç†
- **MCP åè®®**: STDIO å’Œ JSON-RPC 2.0 é€šä¿¡
- **DeepSeek Chat**: å¤§è¯­è¨€æ¨¡å‹ (temperature=0.1)
- **ç±»å‹å®‰å…¨**: TypedDictã€Optionalã€Literal ç±»å‹æ³¨è§£

---

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€æŸ¥è¯¢

```
ç”¨æˆ·: å¸®æˆ‘æŸ¥ä¸€ä¸‹æ˜å¤©ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„é«˜é“ç¥¨
åŠ©æ‰‹: [è°ƒç”¨ 12306 MCP] ä¸ºæ‚¨æŸ¥è¯¢åˆ°ä»¥ä¸‹è½¦æ¬¡...

ç”¨æˆ·: ä¸Šæµ·æ˜å¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
åŠ©æ‰‹: [è°ƒç”¨é«˜å¾· API] ä¸Šæµ·æ˜å¤©å¤šäº‘ï¼Œæ°”æ¸© 15-22Â°C...

ç”¨æˆ·: æ¨èä¸€äº›å¤–æ»©é™„è¿‘çš„ç¾é£Ÿ
åŠ©æ‰‹: [è°ƒç”¨é«˜å¾· POI æœç´¢] ä¸ºæ‚¨æ‰¾åˆ°ä»¥ä¸‹é¤å…...
```

### ä¸ªæ€§åŒ–æ¨è

```
ç”¨æˆ·: æˆ‘æƒ³è®¾ç½®ä¸€ä¸‹æ—…è¡Œåå¥½
åŠ©æ‰‹: å¥½çš„ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨çš„åå¥½...

ç”¨æˆ·: æˆ‘å–œæ¬¢å†å²æ–‡åŒ–å’Œç¾é£Ÿï¼Œå–œæ¬¢æ­¥è¡Œï¼ŒèŠ‚å¥æ‚ é—²ä¸€ç‚¹ï¼Œé¢„ç®—èˆ’é€‚å°±å¥½
åŠ©æ‰‹: [æ›´æ–°ç”¨æˆ·åå¥½] å·²è®°å½•æ‚¨çš„åå¥½ï¼

ç”¨æˆ·: å¸®æˆ‘è§„åˆ’ä¸€ä¸‹ä¸Šæµ·ä¸¤æ—¥æ¸¸
åŠ©æ‰‹: [å¯åŠ¨æ¨èå·¥ä½œæµ]
      - æœç´¢å†å²æ–‡åŒ–æ™¯ç‚¹å’Œç¾é£Ÿåœ°ç‚¹
      - æŸ¥è¯¢æ™¯ç‚¹è¯„ä»·å’Œå£ç¢‘
      - æ¨è 3-4 æ˜Ÿèˆ’é€‚å‹é…’åº—
      - è§„åˆ’æ­¥è¡Œè·¯çº¿
      - ç”Ÿæˆæ‚ é—²èŠ‚å¥çš„è¡Œç¨‹å®‰æ’
```

### é…’åº—æœç´¢

```
ç”¨æˆ·: å¸®æˆ‘æ‰¾ä¸€ä¸‹å¤–æ»©é™„è¿‘çš„é…’åº—ï¼Œ3-4æ˜Ÿçš„
åŠ©æ‰‹: [è°ƒç”¨ AIGoHotel MCP] ä¸ºæ‚¨æ‰¾åˆ°ä»¥ä¸‹é…’åº—ï¼š
      1. ä¸Šæµ·å¤–æ»©XXé…’åº— (4æ˜Ÿ) - Â¥580/æ™š
         ä½ç½®ï¼šè·ç¦»å¤–æ»© 500m
         è¯„åˆ†ï¼š4.5/5.0
      2. ...
```

### è·¯çº¿è§„åˆ’

```
ç”¨æˆ·: ä»å¤–æ»©åˆ°ä¸œæ–¹æ˜ç æ€ä¹ˆèµ°ï¼Ÿ
åŠ©æ‰‹: [è°ƒç”¨é«˜å¾·è·¯çº¿è§„åˆ’]
      æ¨èæ–¹æ¡ˆï¼šæ­¥è¡Œ
      è·ç¦»ï¼šçº¦ 2.1 å…¬é‡Œ
      æ—¶é—´ï¼šçº¦ 25 åˆ†é’Ÿ
      è·¯çº¿ï¼šæ²¿ä¸­å±±ä¸œä¸€è·¯å‘å—...
```

---

## ğŸ”§ å¼€å‘æ–‡æ¡£

### API Keys è·å–

1. **DeepSeek API**: [https://platform.deepseek.com/](https://platform.deepseek.com/)
2. **é«˜å¾·åœ°å›¾ API**: [https://lbs.amap.com/](https://lbs.amap.com/)
3. **Tavily Search API**: [https://tavily.com/](https://tavily.com/)
4. **AIGoHotel MCP Server API**ï¼š[https://mcp.agentichotel.cn/apply](https://mcp.agentichotel.cn/apply)

### æ‰©å±•å¼€å‘

#### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `client/` ç›®å½•åˆ›å»ºå®¢æˆ·ç«¯æ–‡ä»¶
2. åœ¨ `tools/` ç›®å½•åˆ›å»ºå·¥å…·æ–‡ä»¶ï¼Œä½¿ç”¨ `@tool` è£…é¥°å™¨
3. åœ¨ `agent/agent.py` ä¸­æ³¨å†Œå·¥å…·

```python
from langchain.tools import tool

@tool
def your_new_tool(param: str) -> str:
    """å·¥å…·æè¿°"""
    # è°ƒç”¨å®¢æˆ·ç«¯
    result = your_client_function(param)
    return result
```

#### è‡ªå®šä¹‰å·¥ä½œæµ

åœ¨ `workflow/` ç›®å½•åˆ›å»ºæ–°çš„å·¥ä½œæµæ–‡ä»¶ï¼š

```python
from langgraph.graph import StateGraph

workflow = StateGraph(YourState)
workflow.add_node("node1", node1_function)
workflow.add_node("node2", node2_function)
workflow.add_edge("node1", "node2")
workflow.set_entry_point("node1")
workflow.set_finish_point("node2")
```

#### è‡ªå®šä¹‰ä¸­é—´ä»¶

åœ¨ `agent/middleware.py` ä¸­æ·»åŠ æ–°çš„ä¸­é—´ä»¶ï¼š

```python
from langchain.agents.middleware import Middleware

class YourMiddleware(Middleware):
    def process_input(self, input_data):
        # å¤„ç†è¾“å…¥
        return modified_input
    
    def process_output(self, output_data):
        # å¤„ç†è¾“å‡º
        return modified_output
```

---

## ğŸ“Š æŠ€æœ¯äº®ç‚¹

1. **å¤šåè®®é›†æˆ**: åŒæ—¶æ”¯æŒ HTTP RESTã€MCP STDIOã€MCP HTTP ä¸‰ç§é€šä¿¡åè®®
2. **çŠ¶æ€æœºç¼–æ’**: ä½¿ç”¨ LangGraph å®ç°å¤æ‚ä¸šåŠ¡æµç¨‹çš„å¯è§†åŒ–ç¼–æ’
3. **æ™ºèƒ½ä¸Šä¸‹æ–‡ç®¡ç†**: è‡ªåŠ¨æ‘˜è¦ + åŠ¨æ€æç¤ºè¯ï¼Œä¼˜åŒ–é•¿å¯¹è¯æ€§èƒ½
4. **åŒå±‚çŠ¶æ€ç®¡ç†**: TravelContextï¼ˆè¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼‰+ UserPreferenceStateï¼ˆç”¨æˆ·åå¥½ï¼‰åˆ†ç¦»è®¾è®¡
5. **ç±»å‹å®‰å…¨**: å…¨é¢ä½¿ç”¨ TypedDictã€Optionalã€Literal ç­‰ç±»å‹æ³¨è§£
6. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
7. **åå¥½é©±åŠ¨æ¨è**: åŸºäºç”¨æˆ·ç”»åƒè‡ªåŠ¨è°ƒæ•´æœç´¢å‚æ•°

---

## ğŸ“ é¡¹ç›®æˆæœ

- âœ… å®ç° **13 ä¸ªå·¥å…·å‡½æ•°**ï¼Œè¦†ç›–äº¤é€šã€åœ°ç†ã€é…’åº—ã€æœç´¢ç­‰é¢†åŸŸ
- âœ… æ„å»º **5 èŠ‚ç‚¹å·¥ä½œæµ**ï¼Œå®ç°ç«¯åˆ°ç«¯çš„æ—…è¡Œè§„åˆ’è‡ªåŠ¨åŒ–
- âœ… æ”¯æŒ **8 ç»´åº¦ç”¨æˆ·ç”»åƒ**ï¼Œæä¾›ä¸ªæ€§åŒ–æ¨è
- âœ… å¯¹è¯æ‘˜è¦æœºåˆ¶å°†ä¸Šä¸‹æ–‡é•¿åº¦æ§åˆ¶åœ¨ **4000 tokens** ä»¥å†…
- âœ… é›†æˆ **3 ä¸ªå¤–éƒ¨ API** å’Œ **2 ä¸ª MCP æœåŠ¡**

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request


## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ [Issue](https://github.com/InfinteHeart/AI-Powered-Travel-Planning-Assistant/issues)
- å‘é€é‚®ä»¶è‡³: 19861629721@163.com

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼â­**

</div>****
